import streamlit as st
import os

# --- 1. CONFIGURATION & BRANDING ---
def charger_logo():
    if os.path.exists("logo.png"):
        return "logo.png"
    else:
        return "üåø"

st.set_page_config(
    page_title="Anamn√®se Env.", 
    page_icon=charger_logo(),
    layout="centered"
)

# Colonnes pour le Titre + Logo
col_logo, col_texte = st.columns([1, 5])
with col_logo:
    if os.path.exists("logo.png"):
        st.image("logo.png", width=100)
    else:
        st.write("üåø")

with col_texte:
    st.title("Dr. Rachid AMIHA")
    st.subheader("Assistant d'Anamn√®se Environnementale")

st.markdown("---")

# --- 2. INTERFACE : LE PATIENT ---
st.sidebar.header("Profil du Patient")
zone_geo = st.sidebar.selectbox(
    "Zone d'habitation",
    ["Agadir (Urbain/Industriel)", "Zagora (Oasis/Aride)", "Tiznit (Rural/Agricole)"]
)
age_patient = st.sidebar.radio("Tranche d'√¢ge", ["Enfant", "Adulte", "Personne √Çg√©e"])

st.info(f"üìÅ **Dossier en cours :** Patient ({age_patient}) r√©sidant √† **{zone_geo.split(' ')[0]}**.")

# --- 3. SAISIE DES SYMPT√îMES ---
st.write("### ü©∫ Quels sont les motifs de consultation ?")

symptomes_respi = st.multiselect(
    "Sympt√¥mes Respiratoires",
    ["Toux chronique", "Crise d'asthme", "Difficult√© respiratoire", "Irritation nez/gorge"]
)

symptomes_diges = st.multiselect(
    "Sympt√¥mes Digestifs / Autres",
    ["Douleurs abdominales", "Diarrh√©e aig√ºe", "Vomissements", "Fatigue inexpliqu√©e", "Irritations cutan√©es"]
)

# --- 4. LE CERVEAU (ALGORITHME DE DIAGNOSTIC) ---
# C'est ici que votre expertise scientifique s'exprime
st.write("---")
st.write("### üîç Guide d'Interrogatoire Environnemental")

if not (symptomes_respi or symptomes_diges):
    st.caption("üëà S√©lectionnez des sympt√¥mes pour g√©n√©rer les questions d'anamn√®se.")

else:
    # --- SCENARIO 1 : AGADIR + RESPIRATOIRE ---
    if "Agadir" in zone_geo and len(symptomes_respi) > 0:
        st.error("üö® **Alerte : Exposition Atmosph√©rique Probable**")
        st.write("Contexte : Agadir (Pollution trafic, Activit√© Portuaire, Pollens)")
        
        with st.expander("üó£Ô∏è Questions √† poser au patient (L'Enqu√™te)", expanded=True):
            st.markdown("""
            - "Habitez-vous √† moins de 200m d'un grand axe routier ?" (PM2.5)
            - "Avez-vous remarqu√© des d√©p√¥ts de poussi√®re noire sur vos fen√™tres ?"
            - "Les sympt√¥mes s'aggravent-ils lors des jours de Chergui ?"
            """)
        st.success("üí° **Conseil Pr√©ventif :** Limiter l'a√©ration aux heures de pointe. Port du masque en cas de vent de sable.")

    # --- SCENARIO 2 : ZAGORA/TIZNIT + DIGESTIF ---
    elif ("Zagora" in zone_geo or "Tiznit" in zone_geo) and len(symptomes_diges) > 0:
        st.warning("üíß **Alerte : Risque Hydrique / Vectoriel**")
        st.write("Contexte : Zone Rurale/Aride (Qualit√© de l'eau, stockage)")
        
        with st.expander("üó£Ô∏è Questions √† poser au patient (L'Enqu√™te)", expanded=True):
            st.markdown("""
            - "Consommez-vous de l'eau provenant d'un puits ou d'une 'Matfia' ?"
            - "Comment stockez-vous votre eau potable √† domicile ?"
            - "Y a-t-il eu un changement de couleur ou de go√ªt de l'eau r√©cemment ?"
            """)
        st.success("üí° **Conseil Pr√©ventif :** Chloration de l'eau de stockage ou √©bullition avant consommation.")

    # --- SCENARIO 3 : AGRICOLE + CUTAN√â/FATIGUE ---
    elif "Rural" in zone_geo and ("Fatigue inexpliqu√©e" in symptomes_diges or "Irritations cutan√©es" in symptomes_diges):
        st.warning("‚ö†Ô∏è **Alerte : Exposition Chimique (Pesticides)**")
        
        with st.expander("üó£Ô∏è Questions √† poser au patient"):
            st.markdown("""
            - "Travaillez-vous dans les serres ou les champs ?"
            - "Stockez-vous des bidons de produits phytosanitaires √† la maison ?"
            - "Lavez-vous vos v√™tements de travail avec le linge de la famille ?"
            """)

    # --- CAS G√âN√âRAL ---
    else:
        st.info("‚ÑπÔ∏è **Analyse g√©n√©rale**")
        st.write("Les sympt√¥mes s√©lectionn√©s n√©cessitent une investigation standard. Pensez toutefois √† demander l'environnement professionnel.")

# --- 5. PIED DE PAGE P√âDAGOGIQUE ---
st.write("---")
st.caption("Outil p√©dagogique d√©velopp√© par **Dr. Rachid AMIHA** pour la formation ISPITS.")
